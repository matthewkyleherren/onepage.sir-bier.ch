import{i as m}from"./component-manager.modern.DSG18_2G.js";import{a as u}from"./deviceStatus.BebISHRr.js";import{a as A}from"./index.3whys8t3.js";import{s as c}from"./target.z-VVwDyG.js";import{a as r}from"./animation.CYjtRj_b.js";import{s as h}from"./stagger.B2p9fBMh.js";import{e as g}from"./parser.BX5Tv8gU.js";import"./index.K5Rn1T6c.js";import"./targets.Ch0TkwgG.js";import"./timer.BnERl5BE.js";import"./position.DOXOWIVY.js";function d(p,t,e,i,a){const n=i+(a-i)*((p-t)/(e-t));return Math.max(i,Math.min(a,n))}class s extends HTMLElement{static DEFAULT_EASE=g.inOut(2);static DEFAULT_DURATION=1500;static PARALLAX_MAX_OFFSET=400;$svg=null;$group=null;$paths=[];_progress=0;_disabled=!1;_scaleAnimation;_opacityAnimation;_isVisible=!1;isActive=A(!1);_unsubActiveState;set progress(t){this._progress=Math.max(0,Math.min(1,t)),this.style.setProperty("--parallax-progress",`${this._progress}`)}get progress(){return this._progress}connectedCallback(){const{isMobile:t,isTablet:e}=u.get();if(t||e){this._disabled=!0;return}this.initialize(),this.bindEvents()}disconnectedCallback(){this._disabled||this.unbindEvents()}bindEvents(){this._unsubActiveState=this.isActive.subscribe(this.handleActiveState),window.addEventListener("cartography:inview",this.inviewHandler)}unbindEvents(){this._scaleAnimation?.cancel(),this._opacityAnimation?.cancel(),this._unsubActiveState?.(),window.removeEventListener("cartography:inview",this.inviewHandler)}initialize(){if(!this._disabled){if(this.$svg=this.querySelector("svg"),!this.$svg){console.warn("Cartography: No SVG found in slot");return}if(this.$paths=Array.from(this.$svg.querySelectorAll("path")),this.$group=this.$svg.querySelector("g"),!this.$group){this.$group=document.createElementNS("http://www.w3.org/2000/svg","g"),this.$svg.appendChild(this.$group);const t=this.$paths.length,e=s.PARALLAX_MAX_OFFSET;this.$paths.forEach((i,a)=>{this.$group.appendChild(i),i.setAttribute("fill","var(--color-green-light, currentColor)"),i.setAttribute("stroke","var(--color-white)"),i.setAttribute("stroke-width","1px");const n=d(a,0,t-1,0,1),o=a/(t-1||1),l=e*(1-o*.5);i.style.setProperty("--parallax-range",`${l}px`),i.style.transform="translateY(calc((var(--parallax-progress, 0.5) * 2 - 1) * var(--parallax-range)))",i.style.transformBox="fill-box",i.style.transformOrigin="center",i.setAttribute("data-target-opacity",`${n}`),c(i,{opacity:"0"})})}this.style.setProperty("--parallax-progress","0.5"),c(this.$group,{transformOrigin:"left",scale:"0.95",willChange:"transform"})}}hide(){if(this._disabled||!this.$group||!this._isVisible)return;this._isVisible=!1;const t=this.$paths.length;this._scaleAnimation?.cancel(),this._opacityAnimation?.cancel(),this._scaleAnimation=r(this.$group,{scale:"0.95",duration:s.DEFAULT_DURATION+t*20,ease:s.DEFAULT_EASE}),this._opacityAnimation=r(this.$paths,{opacity:"0",delay:h(30),duration:s.DEFAULT_DURATION,ease:s.DEFAULT_EASE})}show(){if(this._disabled||!this.$group||this._isVisible)return;this._isVisible=!0;const t=this.$paths.length;this._scaleAnimation?.cancel(),this._opacityAnimation?.cancel(),this._scaleAnimation=r(this.$group,{scale:"1",duration:s.DEFAULT_DURATION+t*20,ease:s.DEFAULT_EASE}),this._opacityAnimation=r(this.$paths,{opacity:e=>e?.getAttribute("data-target-opacity")??"1",duration:s.DEFAULT_DURATION,delay:h(30,{from:"last"}),ease:s.DEFAULT_EASE})}handleActiveState=t=>{t?this.show():this.hide()};inviewHandler=t=>{const e=t.detail,{target:i,way:a}=e;i===this&&this.isActive.set(a==="enter")}}customElements.define("c-cartography",m(s,"Cartography"));export{s as Cartography};
