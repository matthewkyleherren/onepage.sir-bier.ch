import{i as o}from"./component-manager.modern.DSG18_2G.js";import{f as n}from"./convert.BAjTBXIu.js";import"./index.3whys8t3.js";class c extends HTMLElement{$chapters;$cartography;chaptersHeight;chaptersCount;activeChapterIndex=0;chapterObserver;isCartographyReady=!1;constructor(){super(),this.$chapters=Array.from(this.querySelectorAll("c-story-chapter")),this.chaptersHeight=n(this.getAttribute("data-chapter-height"),0),this.chaptersCount=this.$chapters.length,this.$cartography=this.querySelector("[data-story-cartography]"),this.chapterObserver=new MutationObserver(this.onChapterMutation)}connectedCallback(){this.bindEvents(),this.observeChapters(),customElements.whenDefined("c-story-chapter").then(()=>this.initChapters()),this.$cartography&&customElements.whenDefined("c-cartography").then(()=>{this.isCartographyReady=!0,this.classList.contains("is-inview")&&this.$cartography.show()})}initChapters(){this.$chapters.forEach((t,r)=>{r===0?t?.show?.(!0,!0):t?.hide?.(!0,!0)})}disconnectedCallback(){this.unbindEvents(),this.chapterObserver.disconnect()}bindEvents(){window.addEventListener("story:progress",this.onProgress),window.addEventListener("story:inview",this.onInview)}unbindEvents(){window.removeEventListener("story:progress",this.onProgress),window.removeEventListener("story:inview",this.onInview)}observeChapters(){this.$chapters.forEach(t=>{this.chapterObserver.observe(t,{attributes:!0,attributeFilter:["data-chapter-hidden"]})})}onChapterMutation=t=>{for(const r of t){if(r.attributeName!=="data-chapter-hidden")continue;const e=r.target;e.getAttribute("data-chapter-hidden")==="false"&&(this.activeChapterIndex=e.chapterIndex)}};onInview=t=>{const{target:r,way:e}=t.detail;this===r&&this.isCartographyReady&&(e==="enter"?this.$cartography.show():this.$cartography.hide())};onProgress=t=>{const{target:r,progress:e}=t.detail;this===r&&(this.isCartographyReady&&(this.$cartography.progress=e),this.updateChaptersVisibility(e))};updateChaptersVisibility(t){this.$chapters.forEach((r,e)=>{const s=e===0,i=e===this.chaptersCount-1,h=e/this.chaptersCount,a=(e+1)/this.chaptersCount;t===0&&s||t===1&&i||t>0&&t<1&&t>=h&&t<a?r?.show?.():r?.hide?.()})}goToChapter(t,r=!1){t<0||t>=this.chaptersCount||this.$chapters.forEach((e,s)=>{s===t?e?.show?.(r):e?.hide?.(r)})}}customElements.define("c-story",o(c,"Story"));export{c as Story};
