import{i as o}from"./component-manager.modern.DSG18_2G.js";import{$ as l,t as a}from"./intersectionObserver.Bc8NuwfF.js";import{$ as c}from"./deviceStatus.BebISHRr.js";import{$ as h}from"./screen.DZXYg_So.js";import{$ as u}from"./scroll.thRy0ret.js";import{$ as d}from"./fonts.BORxYCOs.js";import"./index.3whys8t3.js";import"./index.K5Rn1T6c.js";class i extends HTMLElement{static CONFIG={OBSERVER_OPTIONS:{shouldToggle:!0},ANIMATION:{IDLE_VELOCITY:1,SCROLL_VELOCITY_MULTIPLIER:.5}};$container=null;$pattern=null;animationFrameId=null;isPlaying=!1;currentTranslate=0;prevRepeatCount=null;direction=1;eventUnsubscribers={onScreen:null,onFonts:null,onIntersectionReady:null};connectedCallback(){this.initialize()}disconnectedCallback(){this.cleanup()}async initialize(){requestAnimationFrame(()=>{this.setupDomElements(),this.setupConfiguration(),this.bindEvents()})}setupDomElements(){if(this.$container=this.querySelector("[data-container]"),this.$pattern=this.querySelector("[data-pattern]"),!this.$container||!this.$pattern){console.warn("Rail: Missing required DOM elements");return}}setupConfiguration(){const t=this.dataset.direction;this.direction=t?Number(t):1}bindEvents(){this.eventUnsubscribers.onFonts=d.subscribe(this.handleFontsLoaded),this.eventUnsubscribers.onScreen=h.subscribe(this.handleResize),this.eventUnsubscribers.onIntersectionReady=l.subscribe(this.handleIntersectionReady)}unbindEvents(){Object.values(this.eventUnsubscribers).forEach(t=>{t?.()})}handleFontsLoaded=t=>{t.isLoaded&&(this.repeatPattern(),this.eventUnsubscribers.onFonts?.(),this.eventUnsubscribers.onFonts=null)};handleResize=()=>{this.repeatPattern()};handleIntersectionReady=t=>{t&&this.setupIntersectionObserver()};setupIntersectionObserver(){a.observe(this,this.handleIntersection,i.CONFIG.OBSERVER_OPTIONS)}handleIntersection=(t,e)=>{e&&!c.get().isReducedMotion?this.start():this.stop()};onUpdate=()=>{if(!this.$pattern||!this.$container)return;const t=this.$pattern.offsetWidth,e=u.get(),s=Math.abs(e.velocity)*i.CONFIG.ANIMATION.SCROLL_VELOCITY_MULTIPLIER,n=(e.direction===0?1:e.direction)*-1;this.currentTranslate+=(i.CONFIG.ANIMATION.IDLE_VELOCITY+s)*this.direction*n,this.currentTranslate<=-t?this.currentTranslate+=t:this.currentTranslate>=0&&(this.currentTranslate-=t),this.$container.style.transform=`translate3d(${this.currentTranslate}px, 0, 0)`,this.animationFrameId=requestAnimationFrame(this.onUpdate)};start(){this.isPlaying||!this.$container||!this.$pattern||(this.isPlaying=!0,this.animationFrameId=requestAnimationFrame(this.onUpdate))}stop(){this.isPlaying&&(this.isPlaying=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null))}repeatPattern(){if(!this.$pattern||!this.$container)return;const t=this.$pattern.offsetWidth,e=Math.ceil(window.innerWidth/t)+1;if(e===this.prevRepeatCount)return;this.prevRepeatCount=e,this.$container.querySelectorAll("[data-clone]").forEach(n=>n.remove());for(let n=0;n<e-1;n++){const r=this.$pattern.cloneNode(!0);r.setAttribute("data-clone",""),r.setAttribute("aria-hidden","true"),this.$container.appendChild(r)}this.currentTranslate=this.direction===1?-t:0}cleanup(){a.unobserve(this),this.stop(),this.$container=null,this.$pattern=null,this.unbindEvents()}}customElements.define("c-rail",o(i,"Rail"));export{i as Rail};
