import{i as d}from"./component-manager.modern.DSG18_2G.js";import{C as a}from"./config.C_g47voF.js";import{c as h}from"./focus-trap.esm.ClxjYaXz.js";const T=(c,t,i,s,n=null)=>{const l=typeof n=="boolean"?{capture:n}:{...n};let o;return l.signal==null?(o=new AbortController,l.signal=o.signal):o=new AbortController,c.addEventListener(t,r=>{r.target?.matches?.(i)&&s(r)},l),o};class e extends HTMLElement{static CONFIG={CSS_CLASSES:{ACTIVE:"is-active",MODAL_OPEN:"has-modal-open"},ATTRIBUTES:{MODAL_NAME:"modalName",ARIA_HIDDEN:"aria-hidden",ARIA_EXPANDED:"aria-expanded"},SELECTORS:{TOGGLER_SUFFIX:"-toggler",TARGET_SUFFIX:"-target"},FOCUS_TRAP:{VISIBILITY_CHECK_INTERVAL:5}};modalElements={togglers:null,focusTrapTargets:[]};modalState;focusTrap=null;focusTrapConfiguration;eventUnsubscribers={toggle:null};onActivate;onDeactivate;onOpen;onClose;constructor(){super(),this.modalState=this.initializeModalState(),this.focusTrapConfiguration=this.createFocusTrapConfiguration()}initializeModalState(){const t=this.dataset[e.CONFIG.ATTRIBUTES.MODAL_NAME]||"";return{isOpen:!1,isAnimating:!1,name:t,selector:`[data-${t}${e.CONFIG.SELECTORS.TOGGLER_SUFFIX}]`}}initializeModalElements(){const{name:t}=this.modalState;this.modalElements={togglers:document.querySelectorAll(`[data-${t}${e.CONFIG.SELECTORS.TOGGLER_SUFFIX}]`),focusTrapTargets:Array.from(document.querySelectorAll(`[data-${t}${e.CONFIG.SELECTORS.TARGET_SUFFIX}]`))}}createFocusTrapConfiguration(){return{checkCanFocusTrap:this.checkCanFocusTrap.bind(this),onActivate:this.handleFocusTrapActivate.bind(this),onPostActivate:this.handleFocusTrapPostActivate.bind(this),onDeactivate:this.handleFocusTrapDeactivate.bind(this),onPostDeactivate:this.handleFocusTrapPostDeactivate.bind(this),clickOutsideDeactivates:!0}}connectedCallback(){this.bindEvents(),this.initializeFocusTrap()}disconnectedCallback(){this.cleanup()}initializeFocusTrap(){this.initializeModalElements();const t=this.modalElements.focusTrapTargets.length>0?this.modalElements.focusTrapTargets:[this];this.focusTrap=h(t,{...this.focusTrapConfiguration,initialFocus:!1})}async checkCanFocusTrap(t){const i=t.map(s=>this.waitForElementVisibility(s));await Promise.all(i)}waitForElementVisibility(t){return new Promise(i=>{const s=()=>{getComputedStyle(t).visibility!=="hidden"?i():setTimeout(s,e.CONFIG.FOCUS_TRAP.VISIBILITY_CHECK_INTERVAL)};s()})}handleFocusTrapActivate(){this.activateModal(),this.modalState.isAnimating=!1,this.onActivate?.()}handleFocusTrapPostActivate(){this.updateTogglerStates(!0)}handleFocusTrapDeactivate(){this.deactivateModal(),this.modalState.isAnimating=!1,this.dispatchModalEvent(a.MODAL_CLOSE),this.onDeactivate?.()}handleFocusTrapPostDeactivate(){this.setAttribute(e.CONFIG.ATTRIBUTES.ARIA_HIDDEN,"true"),this.updateTogglerStates(!1)}activateModal(){const{ACTIVE:t,MODAL_OPEN:i}=e.CONFIG.CSS_CLASSES,{name:s}=this.modalState;this.classList.add(t),document.documentElement.classList.add(i,`has-${s}-open`),this.setAttribute(e.CONFIG.ATTRIBUTES.ARIA_HIDDEN,"false"),this.modalState.isOpen=!0}deactivateModal(){const{ACTIVE:t,MODAL_OPEN:i}=e.CONFIG.CSS_CLASSES,{name:s}=this.modalState;this.classList.remove(t),document.documentElement.classList.remove(i,`has-${s}-open`),this.modalState.isOpen=!1}updateTogglerStates(t){this.modalElements.togglers.forEach(i=>{i.setAttribute(e.CONFIG.ATTRIBUTES.ARIA_EXPANDED,String(t))})}dispatchModalEvent(t){window.dispatchEvent(new CustomEvent(t,{detail:this}))}bindEvents(){window.addEventListener(a.VISIT_START,this.handleVisitStart),window.addEventListener(a.MODAL_OPEN,this.handleOtherModalOpen),window.addEventListener(a.NAVIGATION_INIT,this.handleNavigationInitialized),window.addEventListener(a.NAVIGATION_UPDATED,this.handleNavigationUpdated),this.eventUnsubscribers.toggle=T(document.body,"click",this.modalState.selector,this.handleToggle)}unbindEvents(){window.removeEventListener(a.VISIT_START,this.handleVisitStart),window.removeEventListener(a.MODAL_OPEN,this.handleOtherModalOpen),window.removeEventListener(a.NAVIGATION_INIT,this.handleNavigationInitialized),window.removeEventListener(a.NAVIGATION_UPDATED,this.handleNavigationUpdated),this.eventUnsubscribers.toggle?.abort?.()}handleToggle=t=>{this.modalState.isAnimating||(this.modalState.isAnimating=!0,this.classList.contains(e.CONFIG.CSS_CLASSES.ACTIVE)?this.close({event:t}):this.open({event:t}))};handleVisitStart=()=>{this.close()};handleOtherModalOpen=t=>{t.detail!==this&&this.close()};handleNavigationUpdated=()=>{this.initializeFocusTrap()};handleNavigationInitialized=()=>{this.initializeFocusTrap()};open(t){this.modalState.isOpen||(this.focusTrap?.activate(),this.onOpen?.(t),this.dispatchModalEvent(a.MODAL_OPEN))}close(t){this.modalState.isOpen&&(this.focusTrap?.deactivate(),this.dispatchModalEvent(a.MODAL_CLOSE),this.onClose?.(t))}rebindTogglers(){this.initializeModalElements()}cleanup(){this.unbindEvents(),this.cleanupFocusTrap()}cleanupFocusTrap(){this.focusTrap?.deactivate(),this.focusTrap=null}}customElements.define("c-modal",d(e,"Modal"));export{e as M,T as d};
